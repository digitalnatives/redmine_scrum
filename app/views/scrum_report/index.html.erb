<div class="contextual">
<%= link_to_if_authorized l(:button_log_time), {:controller => 'scrum_report', :action => 'index', :project_id => @project, :sprint_id => @sprint}, :class => 'icon icon-time-add' %>
</div>

<%#= render_timelog_breadcrumb %>

<h2><%= l(:label_scrum_report) %></h2>

<%= form_tag({:controller => 'scrum_report', :action => 'index', :project_id => @project},:method => :get, :id => 'query_form') do %>
  <%# @report.criteria.each do |criterion| %>
    <%#= hidden_field_tag 'criteria[]', criterion, :id => nil %>
  <%# end %>

  <p>
    <label for='version_id'><%= l(:label_version) %></label>:
    <% if @versions.present? %>
    <%= select_tag 'version_id', options_for_select(@versions.map {|v| ["#{v.name} (#{v.effective_date})", v.id] }, @version.try(:id)), :onchange => "this.form.submit();", :include_blank => true %>
  <% end %>
  </p>
<% end %>

<% unless @report.criteria.empty? %>
<div class="total-hours">
  <p><%= l(:label_total) %>: <%= html_hours(l_hours(@report.total_hours)) %></p>
</div>

<% unless @report.hours.empty? %>
  <div class="autoscroll">
    <table class="list" id="time-report" border="1">
      <thead>
        <tr>
          <% @report.criteria.each do |criteria| %>
            <th rowspan="2"><%= l_or_humanize(@report.available_criteria[criteria][:label]) %></th>
          <% end %>
          <% columns_width = (40 / (@report.periods.length+1)).to_i %>
          <% @report.periods.each do |period| %>
            <th class="period" width="<%= columns_width %>%"><%= period %></th>
          <% end %>
          <th class="total" colspan="2" width="<%= columns_width %>%"><%= l(:label_total) %></th>
        </tr>
        <tr>
          <% @report.periods.each do |period| %>
            <th>&sum;</th>
          <% end %>
          <th>E</th>
          <th>&sum;</th>
        </thead>
        <tbody>
          <%= render :partial => 'report_criteria', :locals => {:criterias => @report.criteria, :hours => @report.hours, :level => 0} %>
          <tr class="total">
            <td><%= l(:label_total) %></td>
            <%= ('<td></td>' * (@report.criteria.size - 1)).html_safe %>
            <% total = 0 -%>
            <% @report.periods.each do |period| -%>
              <% sum = sum_hours(select_hours(@report.hours, @report.columns, period.to_s)); total += sum -%>
              <td class="hours"><%= html_hours("%.2f" % sum) if sum > 0 %></td>
            <% end -%>
            <td class="hours"><%= html_hours("%.2f" % @issues.sum(&:estimated_hours)) if total > 0 %></td>
            <td class="hours"><%= html_hours("%.2f" % total) if total > 0 %></td>
          </tr>
        </tbody>
      </table>
    </div>

    <% other_formats_links do |f| %>
      <%= f.link_to 'CSV', :url => params %>
    <% end %>
  <% end %>
<% end %>

<% html_title l(:label_spent_time), l(:label_report) %>

